<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-6">üîß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <h2 class="text-xl font-semibold mb-4">1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Apps Script</h2>
            <button onclick="testConnection()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            </button>
            <div id="connection-result" class="mt-2"></div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <h2 class="text-xl font-semibold mb-4">2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            <button onclick="testSave()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </button>
            <div id="save-result" class="mt-2"></div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <h2 class="text-xl font-semibold mb-4">3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
            <button onclick="testAddActivity()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 mr-2">
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
            </button>
            <button onclick="testDeleteActivity()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 mr-2">
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
            </button>
            <button onclick="testDeleteByName()" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600">
                ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Å‡πà‡∏≤
            </button>
            <div id="activity-result" class="mt-2"></div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <h2 class="text-xl font-semibold mb-4">4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            <button onclick="testLoad()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
            <div id="load-result" class="mt-2"></div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">5. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Debug</h2>
            <div id="debug-info" class="text-sm text-gray-600"></div>
            
            <!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£ Deploy -->
            <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <h3 class="font-semibold text-yellow-800 mb-2">üîß ‡∏´‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</h3>
                <ol class="list-decimal list-inside text-sm text-yellow-700 space-y-1">
                    <li>‡πÄ‡∏õ‡∏¥‡∏î <a href="https://script.google.com" target="_blank" class="text-blue-600 underline">Google Apps Script</a></li>
                    <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ "Pharm_event"</li>
                    <li>‡∏Ñ‡∏•‡∏¥‡∏Å Deploy ‚Üí Manage deployments</li>
                    <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Edit (‚úèÔ∏è) ‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</li>
                    <li>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Version ‡πÄ‡∏õ‡πá‡∏ô "New version"</li>
                    <li>‡∏Ñ‡∏•‡∏¥‡∏Å Deploy</li>
                    <li>‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzSHNJ4N2r30OFlYvnOhs5VlVkJHY66_RdvsKIsoi7JXm0MTTFNW41Q__1XdCf3WYDxQw/exec";

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const colors = {
                success: 'text-green-600 bg-green-50 border-green-200',
                error: 'text-red-600 bg-red-50 border-red-200',
                info: 'text-blue-600 bg-blue-50 border-blue-200'
            };
            element.innerHTML = `<div class="p-2 border rounded ${colors[type]}">${message}</div>`;
        }

        async function fetchFromScript(action, payload = {}) {
            try {
                console.log('üöÄ Attempting to fetch:', action, payload);
                
                const params = new URLSearchParams({ 
                    action, 
                    data: JSON.stringify(payload) 
                });
                
                const fullUrl = `${SCRIPT_URL}?${params}`;
                console.log('üîó Full URL:', fullUrl);
                
                const response = await fetch(fullUrl, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                console.log('üì® Response status:', response.status);
                console.log('üì® Response ok:', response.ok);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Response error text:', errorText);
                    throw new Error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å Server: ${response.status} - ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ Response result:', result);
                return result;
                
            } catch (error) {
                console.error('‚ùå Fetch error:', error);
                throw error;
            }
        }

        async function testConnection() {
            showResult('connection-result', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'info');
            try {
                const result = await fetchFromScript('getInitialData');
                if (result.status === 'success') {
                    showResult('connection-result', `‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ${result.activities.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'success');
                } else {
                    showResult('connection-result', `‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('connection-result', `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        async function testSave() {
            showResult('save-result', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', 'info');
            try {
                const testPayload = {
                    pscode: 'P01', // ‡πÄ‡∏û‡∏¥‡πà‡∏° PScode ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                    activity: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö Auto ID 16:44:48', // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á
                    round: '1',
                    image: null,
                    coordinates: 'Test Location',
                    latitude: 13.7563,
                    longitude: 100.5018
                };
                
                console.log('üì§ Test save payload:', testPayload);
                
                const response = await fetchFromScript('addRecord', testPayload);
                if (response.status === 'success') {
                    showResult('save-result', `‚úÖ ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ID: ${response.record?.idrecord}`, 'success');
                } else {
                    showResult('save-result', `‚ùå ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${response.message}`, 'error');
                }
            } catch (error) {
                showResult('save-result', `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        async function testAddActivity() {
            showResult('activity-result', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)...', 'info');
            try {
                const testActivity = {
                    activityId: '', // ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    activityName: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö Auto ID ' + new Date().toLocaleTimeString('th-TH'),
                    activityDate: '2025-09-05',
                    round: 1,
                    buddhistYear: 2568
                };
                
                const response = await fetchFromScript('addActivity', testActivity);
                if (response.status === 'success') {
                    showResult('activity-result', `‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á: ${response.activityId}`, 'success');
                } else {
                    showResult('activity-result', `‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${response.message}`, 'error');
                }
            } catch (error) {
                showResult('activity-result', `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        async function testDeleteActivity() {
            showResult('activity-result', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...', 'info');
            try {
                // ‡∏•‡∏≠‡∏á‡∏•‡∏ö activity ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏ô‡∏£‡∏´‡∏±‡∏™)
                const response = await fetchFromScript('deleteActivity', { name: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö Auto ID 16:44:48' });
                if (response.status === 'success') {
                    showResult('activity-result', `‚úÖ ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
                } else {
                    showResult('activity-result', `‚ùå ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${response.message}`, 'error');
                }
            } catch (error) {
                showResult('activity-result', `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        async function testDeleteByName() {
            showResult('activity-result', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Å‡πà‡∏≤...', 'info');
            try {
                // ‡∏•‡∏≠‡∏á‡∏•‡∏ö activity ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                const response = await fetchFromScript('deleteActivity', { name: 'test' });
                if (response.status === 'success') {
                    showResult('activity-result', `‚úÖ ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "test" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
                } else {
                    showResult('activity-result', `‚ùå ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "test" ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${response.message}`, 'error');
                }
            } catch (error) {
                showResult('activity-result', `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        async function testLoad() {
            showResult('load-result', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î...', 'info');
            try {
                const result = await fetchFromScript('getDashboardData', { year: 2025, round: 1 });
                if (result.status === 'success') {
                    showResult('load-result', `‚úÖ ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${result.records?.length || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'success');
                } else {
                    showResult('load-result', `‚ùå ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('load-result', `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        function updateDebugInfo() {
            const debugElement = document.getElementById('debug-info');
            debugElement.innerHTML = `
                <strong>Browser Info:</strong><br>
                - User Agent: ${navigator.userAgent}<br>
                - Geolocation Available: ${navigator.geolocation ? 'Yes' : 'No'}<br>
                - Local Time: ${new Date().toLocaleString('th-TH')}<br>
                <br>
                <strong>Script URL:</strong><br>
                ${SCRIPT_URL}
            `;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        window.addEventListener('load', () => {
            updateDebugInfo();
        });
    </script>
</body>
</html>
